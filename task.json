{
  "task": {
    "title": "Build the Simple WhatsApp-like Chat UI (Priority #1)",
    "goal": "Implement the single-screen WhatsApp-like private chat interface first, with realistic timestamps, date separators, and basic interactivity (typing, pause detection, send). Do not implement full LLM pipeline yet; stub it behind an interface.",
    "priority_order": [
      "1) WhatsApp-like UI fidelity (layout + bubbles + timestamps + date separators + profile picture)",
      "2) Input handling: multiline typing + send button",
      "3) Debounce/pause detection event stream",
      "4) Pluggable hook for preprocessing (gilner_chunking.ipynb logic) and LLM call (stubbed initially)",
      "5) Warning modal UI + two actions (Continue anyway / Accept safer rewrite) (can be wired to a mock response first)"
    ]
  },
  "implementation_constraints": {
    "platform": "Android Studio",
    "language": "Kotlin",
    "ui_framework_preference": "Jetpack Compose",
    "single_screen_only": true,
    "no_real_network_required_initially": true
  },
  "ui_spec": {
    "header": {
      "left": "Back arrow icon (non-functional)",
      "center_left": "Circular profile picture (local drawable placeholder)",
      "center": "Contact name text",
      "right": "Optional icons (non-functional) - can be omitted"
    },
    "chat_body": {
      "layout": "Scrollable column (LazyColumn) with items grouped by date",
      "message_bubbles": {
        "sent": {
          "alignment": "right",
          "color": "WhatsApp-like light green",
          "timestamp": "bottom-right inside bubble"
        },
        "received": {
          "alignment": "left",
          "color": "white",
          "timestamp": "bottom-right inside bubble"
        }
      },
      "date_separator": {
        "text": "Today / Yesterday / MMM d, yyyy",
        "style": "Centered pill/label"
      }
    },
    "composer": {
      "input": "Multiline text field with rounded background",
      "send_button": "Circular button with send icon; enabled only if trimmed text not empty"
    }
  },
  "interaction_spec": {
    "typing_pause_detection": {
      "debounce_ms": 1500,
      "event_name": "onTypingPaused(draftText)",
      "notes": [
        "Trigger whenever the draft changes and then remains unchanged for debounce_ms.",
        "This event must later call preprocessing (gilner_chunking.ipynb masking/chunking) BEFORE LLM."
      ]
    },
    "send_action": {
      "event_name": "onSendPressed(draftText)",
      "behavior": [
        "Append message to transcript with timestamp",
        "Insert date separator if day changed",
        "Clear composer input",
        "Scroll to bottom"
      ]
    }
  },
  "pipeline_hook_spec": {
    "preprocess_hook": {
      "name": "preprocessWithGilnerChunking",
      "status": "stub initially",
      "required_future_behavior": [
        "Call gilner_chunking.ipynb-equivalent logic to mask PII categories and chunk context.",
        "Return maskedDraft + maskedContextChunks + piiSpans (optional)."
      ]
    },
    "risk_assessment_hook": {
      "name": "assessRiskLLM",
      "status": "stub initially",
      "required_future_behavior": [
        "Send only masked/chunked content to backend LLM endpoint.",
        "Return {riskLevel, explanation, saferRewrite}."
      ]
    }
  },
  "warning_modal_spec": {
    "trigger": "When mock/real risk >= Medium upon typing pause",
    "content": ["Risk Level badge", "Brief explanation text", "Two buttons"],
    "buttons": {
      "primary": "Accept safer rewrite (replaces draft text)",
      "secondary": "Continue anyway (dismiss modal; keep draft unchanged)"
    },
    "copy_rules": [
      "Must say 'Continue anyway' (not 'Send anyway').",
      "No claims about monitoring real WhatsApp; this is a simulated interface."
    ]
  },
  "cursor_instructions": {
    "what_to_generate_first": [
      "Compose UI: ChatScreen.kt with header, message list, date separators, composer",
      "Message data model: Message(id, text, direction, timestamp)",
      "Date grouping helper: compute Today/Yesterday labels",
      "Debounce logic using Kotlin Flow or LaunchedEffect + snapshotFlow",
      "Basic UI tests optional (not required)"
    ],
    "code_quality": [
      "Use MVVM: ChatViewModel manages state; UI observes state",
      "Keep warning modal state in ViewModel (e.g., WarningState?)",
      "Use immutable UI state data classes"
    ],
    "explicit_do_not_do": [
      "Do not implement real WhatsApp APIs or accessibility scraping.",
      "Do not add extra screens (chat list, settings) unless asked.",
      "Do not store raw PII or log raw text; if logging is added, log masked text only."
    ]
  }
}
